// Prisma schema for DTID anchor flow

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TouristIdentity {
  id            String   @id @default(cuid())
  subjectAddr   String   // wallet address (lowercase) performing the trip
  tripId        String   // unique per trip (string form)
  didUri        String
  anchorHash    String
  version       Int      @default(1)
  registerTx    String
  updatedAt     DateTime @updatedAt
  createdAt     DateTime @default(now())
  encPIIRef     String   // pointer to encrypted blob (S3/IPFS/etc.)
  contactsMin   String   // JSON string of minimal contacts array
  // Extended KYC metadata (NOT stored on-chain) - all optional
  fullName      String?
  destination   String?
  startDate     DateTime?
  endDate       DateTime?

  @@index([anchorHash])
  @@index([subjectAddr])
  @@unique([subjectAddr, tripId])
}
